	public CompilationUnit[] getCompilationUnits() {
		ArrayList<CompilationUnit> units = new ArrayList<CompilationUnit>();
		for (final JavaFileObject javaFileObject : this.compilationUnits) {
			if (javaFileObject.getKind() != JavaFileObject.Kind.SOURCE) {
				throw new IllegalArgumentException();
			}
			String name = javaFileObject.getName();
			name = name.replace('\\', '/');
			int index = name.lastIndexOf('/');
			units.add(new CompilationUnit(null,
				index == -1 ? name : name.substring(index),
				null) {
				
				public char[] getContents() {
					try {
						return javaFileObject.getCharContent(true).toString().toCharArray();
					} catch(IOException e) {
						throw new AbortCompilationUnit(null, e, null);
					}
				}				
			});
		}
		CompilationUnit[] result = new CompilationUnit[units.size()];
		units.toArray(result);
		return result;
	}

