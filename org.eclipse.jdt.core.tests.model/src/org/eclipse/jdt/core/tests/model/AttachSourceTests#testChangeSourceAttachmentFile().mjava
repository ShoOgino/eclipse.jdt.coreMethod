/**
 * Changing the source attachment file should update the java model.
 * (regression test for bug 23292 Must restart Eclipse after debug of source in .zip is updated)
 */
public void testChangeSourceAttachmentFile() throws CoreException {
	IClassFile cf = this.jarRoot.getPackageFragment("x.y").getClassFile("A.class");
	IMethod method = cf.getType().getMethod("foo", new String[] {});
	String lineSeparator = System.getProperty("line.separator");
	
	// check initial source
	assertEquals(
		"unexpected initial source for foo()",
		"public void foo() {" + lineSeparator +
		"	}",
		method.getSource());

	// replace source attachment file
	this.swapFiles("AttachSourceTests/attachsrc.zip", "AttachSourceTests/attachsrc.new.zip");
	assertEquals(
		"unexpected source for foo() after replacement",
		"public void foo() {" + lineSeparator +
		"		System.out.println(\"foo\");" + lineSeparator +
		"	}",
		method.getSource());
		
	// delete source attachment file
	this.deleteFile("AttachSourceTests/attachsrc.zip");
	assertEquals(
		"unexpected source for foo() after deletion",
		null,
		method.getSource());
		
	// add source attachment file back
	this.moveFile("AttachSourceTests/attachsrc.new.zip", "AttachSourceTests/attachsrc.zip");
	assertEquals(
		"unexpected source for foo() after addition",
		"public void foo() {" + lineSeparator +
		"	}",
		method.getSource());
}

