	protected char[] getSource(IResource resource, IJavaElement element, ICompilationUnit unit) throws CoreException {
		char[] contents = CharOperation.NO_CHAR;
		if ("java".equals(resource.getFileExtension())) {
			ICompilationUnit cu = (ICompilationUnit)element.getAncestor(IJavaElement.COMPILATION_UNIT);
			if (cu != null && cu.isWorkingCopy()) {
				// working copy
				contents = unit.getBuffer().getCharacters();
			} else {
				IFile file = ((IFile) resource);
				contents = new org.eclipse.jdt.internal.compiler.batch.CompilationUnit(
					null, 
					file.getLocation().toFile().getPath(),
					file.getCharset()).getContents();
			}
		}
		return contents;
	}

