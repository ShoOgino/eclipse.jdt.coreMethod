public void deleteFile(File file) {
	file = file.getAbsoluteFile();
	if (!file.exists())
		return;
	if (file.isDirectory()) {
		String[] files = file.list();
		//file.list() can return null
		if (files != null) {
			for (int i = 0; i < files.length; ++i) {
				deleteFile(new File(file, files[i]));
			}
		}
	}
	boolean success = file.delete();
	int retryCount = 60; // wait 1 minute at most
	while (!success && --retryCount >= 0) {
		try {
			Thread.sleep(1000);
		} catch (InterruptedException e) {
		}
		success = file.delete();
	}
	if (success) return;
	System.err.println("Failed to delete " + file.getPath());
}

