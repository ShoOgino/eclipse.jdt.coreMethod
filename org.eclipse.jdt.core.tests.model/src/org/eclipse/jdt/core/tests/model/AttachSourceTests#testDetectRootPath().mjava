/**
 * Attaches a source zip to a jar without specifying the source attachment root. 
 * The source zip has a nested root structure and exists as a resource.  
 * Tests that the source attachment root is detected.
 */
public void testDetectRootPath() throws JavaModelException {
	IJavaProject project = getJavaProject("AttachSourceTests");
	IFile jar = (IFile) project.getProject().findMember("attach2.jar");
	IFile srcZip=(IFile) project.getProject().findMember("attach2src.zip");
	IPackageFragmentRoot root = project.getPackageFragmentRoot(jar);
	root.attachSource(srcZip.getFullPath(), null, null);

	// ensure root path is detected
	IPath rootSAPath= root.getSourceAttachmentRootPath();
	assertEquals("Unexpected source attachment root path for " + root.getPath(), "src/nested", rootSAPath.toString());
	
	// ensure source can be retrieved
	IClassFile cf = root.getPackageFragment("x.y").getClassFile("B.class");
	assertTrue("source code does not exist for the entire attached compilation unit", cf.getSource() != null);
	
	// ensure root path is recomputed
	root.close();
	cf = root.getPackageFragment("x.y").getClassFile("B.class");
	assertTrue("source code does not exist for the entire attached compilation unit", cf.getSource() != null);
}

