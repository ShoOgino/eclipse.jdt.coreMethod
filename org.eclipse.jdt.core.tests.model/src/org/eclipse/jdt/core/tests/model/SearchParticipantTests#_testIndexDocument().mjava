	/*
	 * Ensures that adding index entries through indexDocument() updates the index file.
	 * TODO (jerome) investigate why this test is failing
	 */
	public synchronized void _testIndexDocument() throws CoreException, InterruptedException {
		try {
			createJavaProject("P");
			TestSearchParticipant participant = new TestSearchParticipant(){
				public void indexDocument(SearchDocument document, IPath indexLocation) {
					if (!document.getPath().equals("/P/no")) {
						for (int i = 0; i < 1000; i++) {
							document.addIndexEntry(("category" + i).toCharArray(), ("key" + i).toCharArray());
						}
					}
				}
			};
			TestSearchDocument document = new TestSearchDocument("/P/X.test", participant);
			participant.scheduleDocumentIndexing(document, getIndexLocation());
			waitUntilIndexesReady();
			wait(1100); // wait more than 1000ms so as to allow for the index to be saved on disk
			document = new TestSearchDocument("/P/no", participant);
			participant.scheduleDocumentIndexing(document, getIndexLocation());
			waitUntilIndexesReady();
			assertTrue("Index file should have been written",  getIndexLocation().toFile().length() > 0);
		} finally {
			deleteProject("P");
		}
	}

