/*
 * Search all type names with a prefix in a primary working copy.
 * (regression test for bug 44884 Wrong list displayed while code completion)
 */
public void testAllTypeNames3() throws CoreException {
	ICompilationUnit wc = getCompilationUnit("/JavaSearch/wc3/X44884.java");
	try {
		wc.becomeWorkingCopy(null, null);
		wc.getBuffer().setContents(
			"package wc3;\n" +
			"public class X44884 {\n" +
			"}\n" +
			"interface I {\n" +
			"}"
		);
		wc.makeConsistent(null);
		
		IJavaSearchScope scope = SearchEngine.createJavaSearchScope(new IJavaElement[] {wc.getParent()});
		SearchTests.TypeNameRequestor requestor = new SearchTests.TypeNameRequestor();
		new SearchEngine().searchAllTypeNames(
			ResourcesPlugin.getWorkspace(),
			"wc3".toCharArray(),
			"X".toCharArray(),
			PREFIX_MATCH,
			CASE_INSENSITIVE,
			TYPE,
			scope, 
			requestor,
			IJavaSearchConstants.WAIT_UNTIL_READY_TO_SEARCH,
			null		
		);
		assertSearchResults(
			"Unexpected all type names",
			"wc3.X44884",
			requestor);
	} finally {
		wc.discardWorkingCopy();
	}
}

