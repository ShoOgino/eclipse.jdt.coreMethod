/**
 * CoreException thrown during accept.
 * (regression test for PR #1G3UI7A)
 */
public void testCoreException() throws JavaModelException, CoreException {
	IType type = getCompilationUnit("JavaSearch", "src", "p", "X.java").getType("X");
	IJavaSearchResultCollector resultCollector = new IJavaSearchResultCollector() {
		public void accept(IResource resource, int start, int end, IJavaElement enclosingElement, int accuracy) throws CoreException {
			throw new CoreException(new JavaModelStatus(-1, "test"));
		}
		public void aboutToStart() {}
		public void done() {}
		public IProgressMonitor getProgressMonitor() {
			return null;
		}
	};
	try {
		new SearchEngine().search(
			getWorkspace(), 
			type, 
			DECLARATIONS, 
			getJavaSearchScope(), 
			resultCollector);
	} catch (JavaModelException e) {
		Throwable wrappedException = e.getException();
		assertTrue("Unexpected wrapped exception", wrappedException instanceof CoreException);
		assertEquals("Unexpected CoreException has been thrown", "test", ((CoreException)wrappedException).getStatus().getMessage());
		return;
	}
	assertTrue("CoreException should have been thrown", false);
}

