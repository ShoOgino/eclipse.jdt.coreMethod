private static void setLogDir(StringBuffer buffer) throws CoreException {

	// Compute log dir
	File logDir = new File(System.getProperty("logDir"));
	if (!logDir.exists()) {
		if (!logDir.mkdirs()) {
			System.err.println("Cannot create specified log directory: "+logDir+"!!!");
			return;
		}
	}

	// Compute log sub-directories depending on profiles
	logDir = new File(logDir, ECLIPSE_VERSION);
	if (PATCH_BUG != null) {
		logDir = new File(logDir, "tests");
		logDir = new File(logDir, PATCH_BUG);
		logDir = new File(logDir, PATCH_VERSION);
	} else if (JDT_CORE_HEAD) {
		logDir = new File(logDir, "HEAD");
	} else {
		logDir = new File(logDir, ECLIPSE_MILESTONE);
		logDir = new File(logDir, JDT_CORE_VERSION);
	}
	if (NO_COMMENTS || BRACES != null || JOIN_LINES != null || PRESERVED_LINES != -1) {
		logDir = new File(logDir, "profiles");
		if (JOIN_LINES != null) {
			logDir = new File(new File(logDir, "join_lines"), JOIN_LINES);
		}
		if (NO_COMMENTS) {
			logDir = new File(logDir, "no_comments");
		}
		if (BRACES != null) {
			logDir = new File(new File(logDir, "braces"), BRACES);
		}
		if (PRESERVED_LINES != -1) {
			logDir = new File(new File(logDir, "preserved_lines"), Integer.toString(PRESERVED_LINES));
		}
	}
	
	if (FILES_FILTER_KIND > 0) {
		logDir = new File(new File(logDir, "filter"), FILES_FILTER.replace('?', '_').replace('*', '%'));
	}

	// Create log stream
	logDir.mkdirs();
	String filePrefix = INPUT_DIR.getName().replaceAll("\\.", "");
	String logFileName = filePrefix+".txt";
	LOG_FILE = new File(logDir, logFileName);
	if (LOG_FILE.exists()) {
		File saveDir = new File(logDir, "save");
		saveDir.mkdir();
		int i=0;
		while (true) {
			String newFileName = filePrefix+"_";
			if (i<10) newFileName += "0";
			newFileName += i+".txt";
			File renamedFile = new File(saveDir, newFileName);
			if (LOG_FILE.renameTo(renamedFile)) break;
			i++;
		}
	}
//	LOG_RESOURCE = folder.getFile(logFileName);
	buffer.append("Log file  : ");
	buffer.append(LOG_FILE);
//	buffer.append(LOG_RESOURCE.getFullPath());
	buffer.append(LINE_SEPARATOR);
	try {
		LOG_STREAM = new PrintStream(new BufferedOutputStream(new FileOutputStream(LOG_FILE)));
		LOG_STREAM.flush();
	}
	catch (FileNotFoundException fnfe) {
		System.err.println("Can't create log file"+LOG_FILE); //$NON-NLS-1$
	}
//	if (LOG_RESOURCE.exists()) {
//		Util.delete(LOG_RESOURCE);
//	}
//	LOG_BUFFER = new StringBuffer();
}

