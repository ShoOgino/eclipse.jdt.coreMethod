private static void setOutputDir(String dir, StringBuffer buffer) {

	// Find the root of the output directory
	OUTPUT_DIR = new File(dir);
	if (OUTPUT_DIR.getName().equals(INPUT_DIR.getName())) {
		OUTPUT_DIR = OUTPUT_DIR.getParentFile();
	}
	if (OUTPUT_DIR.getName().equals(ECLIPSE_VERSION)) {
		OUTPUT_DIR = OUTPUT_DIR.getParentFile();
	}
	
	// Add the temporary output if any
	if (TEMP_OUTPUT != null) {
		OUTPUT_DIR = new File(OUTPUT_DIR, TEMP_OUTPUT);
	}

	// Compute output sub-directories depending on profiles
	if (NO_COMMENTS || BRACES != null || JOIN_LINES != null) {
		OUTPUT_DIR = new File(OUTPUT_DIR, "profiles");
		if (JOIN_LINES != null) {
			OUTPUT_DIR = new File(new File(OUTPUT_DIR, "join_lines"), JOIN_LINES);
		}
		if (NO_COMMENTS) {
			OUTPUT_DIR = new File(OUTPUT_DIR, "no_comments");
		}
		if (BRACES != null) {
			OUTPUT_DIR = new File(new File(OUTPUT_DIR, "braces"), BRACES);
		}
	}

	// Compute the final output dir
	OUTPUT_DIR = new File(new File(OUTPUT_DIR, ECLIPSE_VERSION), INPUT_DIR.getName());
	buffer.append("Output dir: ");
	buffer.append(OUTPUT_DIR);
	buffer.append(LINE_SEPARATOR);
	if (CLEAN) {
		buffer.append("            CLEANED");
		buffer.append(LINE_SEPARATOR);
	}
}

