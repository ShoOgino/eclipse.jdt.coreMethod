/*
 * Removes from the given list of working copies the ones that cannot see the given focus.
 */
private ICompilationUnit[] filterWorkingCopies(ICompilationUnit[] copies, IJavaElement focus, boolean isPolymorphicSearch) {
	if (focus == null || copies == null) return copies;
	while (!(focus instanceof IJavaProject) && !(focus instanceof JarPackageFragmentRoot)) {
		focus = focus.getParent();
	}
	int length = copies.length;
	ICompilationUnit[] result = null;
	int index = -1;
	for (int i=0; i<length; i++) {
		ICompilationUnit workingCopy = copies[i];
		IPath projectOrJar = IndexSelector.getProjectOrJar(workingCopy).getPath();
		if (!IndexSelector.canSeeFocus(focus, isPolymorphicSearch, projectOrJar)) {
			if (result == null) {
				result = new ICompilationUnit[length-1];
				System.arraycopy(copies, 0, result, 0, i);
				index = i;
			}
		} else if (result != null) {
			result[index++] = workingCopy;
		}
	}
	if (result != null) {
		if (result.length != index) {
			System.arraycopy(result, 0, result = new ICompilationUnit[index], 0, index);
		}
		return result;
	} else {
		return copies;
	}
}

