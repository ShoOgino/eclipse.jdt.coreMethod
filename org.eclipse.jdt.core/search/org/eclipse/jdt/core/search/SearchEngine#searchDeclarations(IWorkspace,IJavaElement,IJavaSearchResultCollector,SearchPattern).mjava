	private void searchDeclarations(IWorkspace workspace, IJavaElement enclosingElement, IJavaSearchResultCollector resultCollector, SearchPattern pattern) throws JavaModelException {
		IJavaSearchScope scope = createJavaSearchScope(new IJavaElement[] {enclosingElement});
		IResource resource = this.getResource(enclosingElement);
		try {
			if (resource instanceof IFile) {
				if (VERBOSE) {
					System.out.println("Searching for " + pattern + " in " + resource.getFullPath()); //$NON-NLS-1$//$NON-NLS-2$
				}
				SearchParticipant participant = getDefaultSearchParticipant();
				SearchDocument[] documents = pattern.addWorkingCopies(
					new SearchDocument[] {new JavaSearchDocument(enclosingElement.getPath().toString(), participant)},
					getWorkingCopies(enclosingElement),
					participant);
				participant.locateMatches(
					documents, 
					pattern, 
					scope, 
					new ResultCollectorAdapter(resultCollector), 
					resultCollector.getProgressMonitor());
			} else {
				search(
					pattern, 
					new SearchParticipant[] {getDefaultSearchParticipant()}, 
					scope, 
					new ResultCollectorAdapter(resultCollector), 
					resultCollector.getProgressMonitor());
			}
		} catch (CoreException e) {
			if (e instanceof JavaModelException) {
				throw (JavaModelException) e;
			} else {
				throw new JavaModelException(e);
			}
		}
	}

