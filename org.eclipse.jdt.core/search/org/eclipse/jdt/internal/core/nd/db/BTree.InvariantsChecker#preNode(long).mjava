		@Override
		public void preNode(long node) throws IndexException {
			depth++;

			// Collect information for checking.
			int keyCount = 0;
			int indexFirstBlankKey = MAX_RECORDS;
			int indexLastNonBlankKey = 0; 
			for (int i= 0; i < MAX_RECORDS; i++) {
				if (getRecord(db.getChunk(node), node, i) != 0) {
					keyCount++;
					indexLastNonBlankKey = i;
				} else if (indexFirstBlankKey == MAX_RECORDS) {
					indexFirstBlankKey = i;
				}
			}

			int childCount = 0;
			for (int i= 0; i < MAX_CHILDREN; i++) {
				if (getChild(db.getChunk(node), node, i) != 0) {
					childCount++;
				}
			}

			// Check that non-blank keys are contiguous and blank key terminated.
			if (indexFirstBlankKey != indexLastNonBlankKey + 1) {
				boolean full = indexFirstBlankKey == MAX_RECORDS && indexLastNonBlankKey == MAX_RECORDS - 1;
				boolean empty = indexFirstBlankKey == 0 && indexLastNonBlankKey == 0;
				if (!full && !empty) {
					valid = false;
					msg += MessageFormat.format("[{0} blanks inconsistent b={1} nb={2}]", //$NON-NLS-1$
							new Object[] { new Long(node), new Integer(indexFirstBlankKey),
									new Integer(indexLastNonBlankKey) });
				}
			}

			// Check: Key number constrains child numbers
			if (childCount != 0 && childCount != keyCount + 1) {
				valid = false;
				msg += MessageFormat.format("[{0} wrong number of children with respect to key count]", //$NON-NLS-1$
						new Object[] { new Long(node) });
			}

			// The root node is excused from the remaining node constraints.
			if (node == db.getRecPtr(rootPointer)) {
				return; 
			}

			// Check: Non-root nodes must have a keyCount within a certain range
			if (keyCount < MIN_RECORDS || keyCount > MAX_RECORDS) {
				valid = false;
				msg += MessageFormat.format("[{0} key count out of range]", new Object[] { new Long(node) }); //$NON-NLS-1$
			}

			// Check: All leaf nodes are at the same depth
			if (childCount == 0) {
				if (leafDepth == null) {
					leafDepth = new Integer(depth);
				}
				if (depth != leafDepth.intValue()) {
					valid = false;
					msg += "Leaf nodes at differing depths"; //$NON-NLS-1$
				}
			}
		}

