	/**
	 * Infinite loop performing resource indexing
	 */
	public void run() {

		long idlingStart = -1;
		activateProcessing();
		try {
			while (true) {
				try {
					IJob job;
					if ((job = currentJob()) == null) {
						if (idlingStart < 0)
							idlingStart = System.currentTimeMillis();
						notifyIdle(System.currentTimeMillis() - idlingStart);
						Thread.currentThread().sleep(500);
						continue;
					} else {
						idlingStart = -1;
					}
					if (VERBOSE) {
						JobManager.log(awaitingJobsCount() + " awaiting jobs"); //$NON-NLS-1$
						JobManager.log("STARTING to execute - " + job); //$NON-NLS-1$
					}
					try {
						executing = true;
						/*boolean status = */job.execute(null);
						//if (status == FAILED) request(job);
					} finally {
						executing = false;
						if (VERBOSE) {
							JobManager.log("DONE executing - " + job); //$NON-NLS-1$
						}
						moveToNextJob();
						if (this.awaitingClients == 0) {
							Thread.sleep(50);
						}
					}
				} catch (InterruptedException e) { // background indexing was interrupted
				}
			}
		} catch (RuntimeException e) {
			// log exception
			JavaCore.getPlugin().getLog().log(
				new JavaModelStatus(
					IJavaModelStatus.ERROR,
					e)
			);
			
			// keep job manager alive
			this.discardJobs(null);
			this.thread = null;
			this.reset(); // this will fork a new thread
			throw e;
		}
	}

