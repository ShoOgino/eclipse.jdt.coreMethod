/**
 * Ensures that indexes are up to date with workbench content. Typically
 * it is invoked in background when activate the job processing.
 */
public void checkIndexConsistency() {

	if (VERBOSE) JobManager.verbose("STARTING ensuring consistency"); //$NON-NLS-1$

	boolean wasEnabled = isEnabled();	
	try {
		disable();

		IWorkspace workspace =  ResourcesPlugin.getWorkspace();
		if (workspace == null) return; // NB: workspace can be null if it has shut down (see http://dev.eclipse.org/bugs/show_bug.cgi?id=16175)
		IProject[] projects = workspace.getRoot().getProjects();
		for (int i = 0, max = projects.length; i < max; i++){
			IProject project = projects[i];
			// not only java project, given at startup nature may not have been set yet
			if (project.isOpen()) { 
				indexAll(project);
			}
		}
	} finally {
		if (wasEnabled) enable();
		if (VERBOSE) JobManager.verbose("DONE ensuring consistency"); //$NON-NLS-1$
	}
}

