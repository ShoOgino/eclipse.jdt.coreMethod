private void computeClasspathLocations(
	IWorkspaceRoot workspaceRoot,
	JavaProject javaProject) throws CoreException {

	String encoding = null;
	IPackageFragmentRoot[] roots = javaProject.getAllPackageFragmentRoots();
	int length = roots.length;
	ClasspathLocation[] cpLocations = new ClasspathLocation[length];
	JavaModelManager manager = JavaModelManager.getJavaModelManager();
	for (int i = 0; i < length; i++) {
		IPackageFragmentRoot root = roots[i];
		IPath path = root.getPath();
		if (root.isArchive()) {
			ZipFile zipFile = manager.getZipFile(path);
			cpLocations[i] = new ClasspathJar(zipFile);
		} else {
			Object target = JavaModel.getTarget(workspaceRoot, path, false);
			if (root.getKind() == IPackageFragmentRoot.K_SOURCE) {
				if (encoding == null) {
					encoding = javaProject.getOption(JavaCore.CORE_ENCODING, true);
				}
				cpLocations[i] = new ClasspathSourceDirectory((IContainer)target, encoding);
			} else {
				cpLocations[i] = ClasspathLocation.forBinaryFolder((IContainer) target, false);
			}
		}
	}
	this.locations = cpLocations;
}

