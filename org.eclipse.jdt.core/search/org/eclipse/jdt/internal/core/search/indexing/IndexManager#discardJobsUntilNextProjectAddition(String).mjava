/**
 * Remove the index from cache for a given project.
 * Passing null as a job family discards them all.
 */
public void discardJobsUntilNextProjectAddition(String jobFamily) {
	boolean wasEnabled = isEnabled();
	try {
		disable();
		
		// cancel current job if it belongs to the given family
		IJob currentJob = this.currentJob();
		if (currentJob != null 
				&& (jobFamily == null || currentJob.belongsTo(jobFamily))) {

			currentJob.cancel();
		
			// wait until current active job has finished
			while (thread != null && executing){
				try {
					Thread.currentThread().sleep(50);
				} catch(InterruptedException e){
				}
			}
		}

		synchronized(this) {
			// flush and compact awaiting jobs
			int loc = -1;
			boolean foundProjectAddition = false;
			for (int i = jobStart; i <= jobEnd; i++){
				currentJob = awaitingJobs[i];
				if (currentJob == null) continue;
				awaitingJobs[i] = null;
				boolean discard = jobFamily == null;
				if (!discard && currentJob.belongsTo(jobFamily)){ // might discard
					if (!(foundProjectAddition || (foundProjectAddition = currentJob instanceof IndexAllProject))) {
						discard = true;
					}
				}
				if (discard) {
					currentJob.cancel();
				} else {
					awaitingJobs[++loc] = currentJob;
				}
			}
			jobStart = 0;
			jobEnd = loc;
		}
	} finally {
		if (wasEnabled) enable();
	}
}

