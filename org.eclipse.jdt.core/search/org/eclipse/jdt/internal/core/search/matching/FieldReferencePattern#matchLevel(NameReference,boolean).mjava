/**
 * Returns whether this field reference pattern matches the given name reference.
 * Look at resolved information only if specified.
 */
private int matchLevel(NameReference nameRef, boolean resolve) {	
	if (!resolve) {
		// field name
		if (this.name == null) {
			return this.needsResolve ? POSSIBLE_MATCH : ACCURATE_MATCH;
		} else {
			if (nameRef instanceof SingleNameReference) {
				if (this.matchesName(this.name, ((SingleNameReference)nameRef).token)) {
					// can only be a possible match since resolution is needed 
					// to find out if it is a field ref
					return POSSIBLE_MATCH;
				} else {
					return IMPOSSIBLE_MATCH;
				}
			} else { // QualifiedNameReference
				QualifiedNameReference qNameRef = (QualifiedNameReference)nameRef;
				char[][] tokens = qNameRef.tokens;
				if (this.writeAccess && !this.readAccess) {
					// in the case of the assigment of a qualified name reference, the match must be on the last token
					if (this.matchesName(this.name, tokens[tokens.length-1])) {
						// can only be a possible match since resolution is needed 
						// to find out if it is a field ref
						return POSSIBLE_MATCH;
					}
				} else {
					for (int i = 0, max = tokens.length; i < max; i++){
						if (this.matchesName(this.name, tokens[i])) {
							// can only be a possible match since resolution is needed 
							// to find out if it is a field ref
							return POSSIBLE_MATCH;
						}
					}
				}
				return IMPOSSIBLE_MATCH;
			}				
		} 
	} else {
		Binding binding = nameRef.binding;
		if (binding == null) {
			return INACCURATE_MATCH;
		} else {
			if (nameRef instanceof SingleNameReference){
				if (binding instanceof FieldBinding){
					return this.matchLevel((FieldBinding) binding);
				} else {
					return IMPOSSIBLE_MATCH; // must be a field binding
				}
			} else { // QualifiedNameReference
				QualifiedNameReference qNameRef = (QualifiedNameReference)nameRef;
				FieldBinding fieldBinding = null;
				if (binding instanceof FieldBinding && this.matchesName(this.name, (fieldBinding = (FieldBinding)binding).name)) {
					return this.matchLevel(fieldBinding);
				} else {
					int otherLevel = IMPOSSIBLE_MATCH;
					int otherMax = qNameRef.otherBindings == null ? 0 : qNameRef.otherBindings.length;
					for (int i = 0; i < otherMax && (otherLevel == IMPOSSIBLE_MATCH); i++){
						char[] token = qNameRef.tokens[i + qNameRef.indexOfFirstFieldBinding];
						if (this.matchesName(this.name, token)) {
							FieldBinding otherBinding = qNameRef.otherBindings[i];
							otherLevel = this.matchLevel(otherBinding);
						}
					}
					return otherLevel;
				}
			}
		}
	}
}

