/**
 * Returns whether this field reference pattern matches the given name reference.
 * Look at resolved information only if specified.
 */
private boolean matches(NameReference nameRef, boolean resolve) {	
	// field name
	boolean nameMatch = true;
	if (this.name != null) {
		if (nameRef instanceof SingleNameReference) {
			nameMatch = matchesName(this.name, ((SingleNameReference)nameRef).token);
		} else { // QualifiedNameReference
			nameMatch = false;
			QualifiedNameReference qNameRef = (QualifiedNameReference)nameRef;
			char[][] tokens = qNameRef.tokens;
			for (int i = qNameRef.indexOfFirstFieldBinding-1, max = tokens.length; i < max && !nameMatch; i++){
				if (i >= 0) nameMatch = matchesName(this.name, tokens[i]);
			}
		}				
	} 
	if (!nameMatch) return false;

	if (resolve){	
		Binding binding = nameRef.binding;
		if (binding != null){
			if (nameRef instanceof SingleNameReference){
				if (binding instanceof FieldBinding){
					if (!this.matches(nameRef.receiverType, false, (FieldBinding) binding)){
						return false;
					}
				} else {
					return false; // must be a field binding
				}
			} else { // QualifiedNameReference
				QualifiedNameReference qNameRef = (QualifiedNameReference)nameRef;
				TypeBinding receiverType = qNameRef.receiverType;
				FieldBinding fieldBinding = null;
				if (!(binding instanceof FieldBinding 
						&& matchesName(this.name, (fieldBinding = (FieldBinding)binding).name) 
						&& matches(receiverType, false, fieldBinding))){
					if (binding instanceof VariableBinding){
						receiverType = ((VariableBinding) binding).type;
					}
					boolean otherMatch = false;
					int otherMax = qNameRef.otherBindings == null ? 0 : qNameRef.otherBindings.length;
					for (int i = 0; i < otherMax && !otherMatch; i++){
						FieldBinding otherBinding = qNameRef.otherBindings[i];
						if (otherBinding == null) break;
						otherMatch = matchesName(this.name, otherBinding.name) && matches(receiverType, false, otherBinding);
						receiverType = otherBinding.type;
					}
					if (!otherMatch) return false;
				}
			}
		}
	}
	return true;
}

