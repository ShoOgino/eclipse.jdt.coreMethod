/**
 * Trigger addition of a library to an index
 * Note: the actual operation is performed in background
 */
public void indexLibrary(IPath path, IProject referingProject) {
	if (JavaCore.getPlugin() == null) return;

	Object target = JavaModel.getTarget(ResourcesPlugin.getWorkspace().getRoot(), path, true);
	
	IndexRequest request = null;
	IPath folderPath = null;
	if (target instanceof IFile) {
		request = new AddJarFileToIndex((IFile)target, this, referingProject.getName());
	} else if (target instanceof java.io.File) {
		// remember the timestamp of this library
		long timestamp = DeltaProcessor.getTimeStamp((java.io.File)target);
		JavaModelManager.getJavaModelManager().deltaProcessor.externalTimeStamps.put(path, new Long(timestamp));
		request = new AddJarFileToIndex(path, this, referingProject.getName());
	} else if (target instanceof IFolder) {
		request = new IndexBinaryFolder((IFolder)target, this, referingProject);
		folderPath = ((IFolder)target).getFullPath();
	} else {
		return;
	}
	
	// check if the same request is not already in the queue
	for (int i = this.jobEnd; i >= this.jobStart; i--) {
		IJob awaiting = this.awaitingJobs[i];
		if (awaiting != null && request.equals(awaiting)) {
			return;
		}
	}

	this.request(request);
	// request to save index when all class files have been indexed
	// want to release any memory immediately before other index jobs start
	if (folderPath != null)
		this.request(new SaveIndex(folderPath, this));
}

