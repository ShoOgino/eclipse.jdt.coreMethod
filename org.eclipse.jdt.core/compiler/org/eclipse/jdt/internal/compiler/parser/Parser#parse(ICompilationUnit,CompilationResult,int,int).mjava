public CompilationUnitDeclaration parse(
	ICompilationUnit sourceUnit, 
	CompilationResult compilationResult,
	int start,
	int end) {
	// parses a compilation unit and manages error handling (even bugs....)

	CompilationUnitDeclaration unit;
	try {
		/* automaton initialization */
		initialize();
		goForCompilationUnit();

		/* scanners initialization */
		char[] contents = sourceUnit.getContents();
		scanner.setSource(contents);
		if (end != -1) scanner.resetTo(start, end);
		if (this.annotationParser.checkAnnotation) {
			this.annotationParser.scanner.setSource(contents);
			if (end != -1) {
				this.annotationParser.scanner.resetTo(start, end);
			}
		}
		/* unit creation */
		referenceContext = 
			compilationUnit = 
				new CompilationUnitDeclaration(
					problemReporter, 
					compilationResult, 
					scanner.source.length);
		/* run automaton */
		parse();
	} finally {
		unit = compilationUnit;
		compilationUnit = null; // reset parser
		// tag unit has having read bodies
		if (!this.diet) unit.bits |= AstNode.HasAllMethodBodies;		
	}
	return unit;
}

