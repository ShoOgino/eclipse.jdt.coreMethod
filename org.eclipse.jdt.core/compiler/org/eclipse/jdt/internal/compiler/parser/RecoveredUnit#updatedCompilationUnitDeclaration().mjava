public CompilationUnitDeclaration updatedCompilationUnitDeclaration(){

	/* update imports */
	if (importCount > 0){
		ImportReference[] importRefences = new ImportReference[importCount];
		for (int i = 0; i < importCount; i++){
			importRefences[i] = imports[i].updatedImportReference();
		}
		unitDeclaration.imports = importRefences;
	}
	/* update types */
	if (typeCount > 0){
		int existingCount = unitDeclaration.types == null ? 0 : unitDeclaration.types.length;
		TypeDeclaration[] typeDeclarations = new TypeDeclaration[existingCount + typeCount];
		if (existingCount > 0){
			System.arraycopy(unitDeclaration.types, 0, typeDeclarations, 0, existingCount);
		}
		// may need to update the declarationSourceEnd of the last type
		if (types[typeCount - 1].typeDeclaration.declarationSourceEnd == 0){
			types[typeCount - 1].typeDeclaration.declarationSourceEnd = unitDeclaration.sourceEnd;
			types[typeCount - 1].typeDeclaration.bodyEnd = unitDeclaration.sourceEnd;
		}
		int actualCount = existingCount;
		for (int i = 0; i < typeCount; i++){
			TypeDeclaration typeDecl = types[i].updatedTypeDeclaration();
			// filter out local types (12454)
			if (!(typeDecl instanceof LocalTypeDeclaration)){
				typeDeclarations[actualCount++] = typeDecl;
			}
		}
		if (actualCount != typeCount){
			System.arraycopy(
				typeDeclarations, 
				0, 
				typeDeclarations = new TypeDeclaration[existingCount+actualCount], 
				0, 
				existingCount+actualCount);
		}
		unitDeclaration.types = typeDeclarations;
	}
	return unitDeclaration;
}

