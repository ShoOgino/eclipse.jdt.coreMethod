/**
 * After an 'annotatedType' has been substituted yielding 'unannotatedSubstitute,
 * use this method to re-apply the null type annotations from 'annotatedType' to the substitute.
 * We assume that both types are structurally equivalent.
 */
public TypeBinding copyAnnotations(TypeBinding annotatedType, TypeBinding unannotatedSubstite) {
	if (!annotatedType.hasNullTypeAnnotations())
		return unannotatedSubstite;

	// FIXME(stephan): what if both types have (some) null annotations??
	if (unannotatedSubstite instanceof ReferenceBinding) {
		TypeBinding[] newArguments = null;
		if (annotatedType.isParameterizedType() && unannotatedSubstite.isParameterizedType()) {
			ParameterizedTypeBinding unannotatedPTB = (ParameterizedTypeBinding) unannotatedSubstite;
			ParameterizedTypeBinding annotatedPTB = (ParameterizedTypeBinding) annotatedType;
			if (unannotatedPTB.arguments != null 
					&& annotatedPTB.arguments != null
					&& unannotatedPTB.arguments.length == annotatedPTB.arguments.length) {
				int length = annotatedPTB.arguments.length;
				newArguments = new TypeBinding[length];
				for (int i = 0; i < length; i++) {
					newArguments[i] = copyAnnotations(annotatedPTB.arguments[i], unannotatedPTB.arguments[i]);
				}
			}
		}
		ReferenceBinding annotatedEnclosing = annotatedType.enclosingType();
		ReferenceBinding newEnclosing = unannotatedSubstite.enclosingType();
		if (annotatedEnclosing != null && annotatedEnclosing.hasNullTypeAnnotations())
			newEnclosing = (ReferenceBinding) copyAnnotations(annotatedEnclosing, newEnclosing);
		long nullTagBits = annotatedType.tagBits & TagBits.AnnotationNullMASK;
		return createParameterizedType((ReferenceBinding)unannotatedSubstite, newArguments, nullTagBits, newEnclosing);

	} else if (annotatedType instanceof ArrayBinding && unannotatedSubstite instanceof ArrayBinding) {
		long[] tagBitsOnDimensions = ((ArrayBinding) annotatedType).nullTagBitsPerDimension;
		TypeBinding annotatedLeaf = annotatedType.leafComponentType();
		TypeBinding newLeafType = unannotatedSubstite.leafComponentType(); 
		if (annotatedLeaf.hasNullTypeAnnotations())
			newLeafType = copyAnnotations(annotatedLeaf, newLeafType);
		return createArrayType(newLeafType, unannotatedSubstite.dimensions(), tagBitsOnDimensions);
	}
	return unannotatedSubstite; // shouldn't happen actually
}

