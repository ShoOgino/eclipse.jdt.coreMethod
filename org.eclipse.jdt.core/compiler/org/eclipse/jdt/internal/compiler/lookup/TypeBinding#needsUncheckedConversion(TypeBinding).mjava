/**
 * Meant to be invoked on compatible types, to figure if unchecked conversion is necessary
 */
public boolean needsUncheckedConversion(TypeBinding targetType) {

	if (this == targetType) return false;
	targetType = targetType.leafComponentType();
	if (!(targetType instanceof ReferenceBinding)) 
		return false;

	TypeBinding currentType = this.leafComponentType();
	if (!(currentType instanceof ReferenceBinding))
		return false;
	
	ReferenceBinding compatible = ((ReferenceBinding)currentType).findSuperTypeWithSameErasure(targetType);
	if (compatible == null) 
		return false;

	int depth = 0;
	while (compatible.isRawType()) {
		if (targetType.isGenericType()) return true;
		// tolerate unbound only for innermost
		if (depth == 0 ? targetType.isBoundParameterizedType() : targetType.isParameterizedType()) return true;

		if (compatible.isStatic()) break;
		if ((compatible = compatible.enclosingType()) == null) break;
		if ((targetType = targetType.enclosingType()) == null) break;
		depth++;
	}
	return false;
}

