public void optimizeBranch(int oldPosition, BranchLabel lbl) {
	for (int i = 0; i < this.countLabels; i++) {
		BranchLabel label = this.labels[i];
		if (oldPosition == label.position) {
			label.position = position;
			if (label instanceof CaseLabel) {
				int offset = position - ((CaseLabel) label).instructionPosition;
				for (int j = 0; j < label.forwardReferenceCount; j++) {
					int forwardPosition = label.forwardReferences[j];
					this.writeWidePosition(forwardPosition, offset);
				}
			} else {
				for (int j = 0; j < label.forwardReferenceCount; j++) {
					final int forwardReference = label.forwardReferences[j];
					this.writePosition(lbl, forwardReference);
				}
			}
		}
	}
}

