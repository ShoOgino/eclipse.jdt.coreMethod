	protected void processAnnotations(ICompilationUnit[] sourceUnits) {
		int newUnitSize = 0;
		int bottom = 0;
		int top = this.unitsToProcess.length;
		if (top == 0) return;
		do {
			// extract units to process
			int length = top - bottom + 1;
			CompilationUnitDeclaration[] currentUnits = new CompilationUnitDeclaration[length];
			int index = 0;
			for (int i = bottom; i < top; i++) {
				CompilationUnitDeclaration currentUnit = this.unitsToProcess[i];
				if ((currentUnit.bits & ASTNode.IsImplicitUnit) == 0) {
					currentUnits[index++] = currentUnit;
				}
			}
			if (index != length) {
				System.arraycopy(currentUnits, 0, (currentUnits = new CompilationUnitDeclaration[index]), 0, index);
			}
			this.annotationProcessorManager.processAnnotations(currentUnits, false);
			ICompilationUnit[] newUnits = this.annotationProcessorManager.getNewUnits();
			if (newUnits.length != 0) {
				// we reset the compiler in order to restart with the new units
				beginToCompile(newUnits);
				bottom = top + 1;
				top = this.unitsToProcess.length;
				this.annotationProcessorManager.reset();
			}
		} while (newUnitSize != 0);
		// one more loop to create possible resources
		// this loop cannot create any java source files
		this.annotationProcessorManager.processAnnotations(unitsToProcess, true);
		// TODO we might want to check if this loop created new units
	}

