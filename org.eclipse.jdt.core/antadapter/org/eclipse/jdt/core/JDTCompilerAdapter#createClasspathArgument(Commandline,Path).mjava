	/**
	 * Copy the classpath to the command line with access rules included.
	 * @param cmd
	 * @param classpath
	 */
	private void createClasspathArgument(Commandline cmd, Path classpath) {
		Argument arg = cmd.createArgument();
		final String[] pathElements = classpath.list();

		// empty path return empty string
		if (pathElements.length == 0) {
			arg.setValue(""); //$NON-NLS-1$
			return;
		}

		// no access rules, can set the path directly
		if (accessRules == null) {
			arg.setPath(classpath);
			return;
		}

		int rulesLength = accessRules.size();
		String[] rules = (String[]) accessRules.toArray(new String[rulesLength]);
		int nextRule = 0;
		final StringBuffer result = new StringBuffer();

		//access rules are expected in the same order as the classpath, but there could
		//be elements in the classpath not in the access rules or access rules not in the classpath
		for (int i = 0; i < pathElements.length; i++) {
			if (i > 0)
				result.append(File.pathSeparatorChar);
			result.append(pathElements[i]);
			//the rules list is [path, rule, path, rule, ...]
			for (int j = nextRule; j < rulesLength; j += 2) {
				if (pathElements[i].endsWith(rules[j])) {
					result.append(rules[j + 1]);
					nextRule = j + 2;
					break;
				}
			}
		}

		arg.setValue(result.toString());
	}

