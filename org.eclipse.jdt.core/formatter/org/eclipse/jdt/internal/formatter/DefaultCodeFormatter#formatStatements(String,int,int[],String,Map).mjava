	private String formatStatements(String source, int indentationLevel, int[] positions, String lineSeparator, Map options) {
		ConstructorDeclaration constructorDeclaration = parseStatements(source.toCharArray(), options);
		
		if (constructorDeclaration.statements == null) {
			// a problem occured while parsing the source
			return source;
		}
		if (lineSeparator != null) {
			this.preferences.line_delimiter = lineSeparator;
		}
		this.preferences.initial_indentation_level = indentationLevel;

		this.newCodeFormatter = new CodeFormatterVisitor(this.preferences, options);
		
		String result = this.newCodeFormatter.format(source, positions, constructorDeclaration);
		if (positions != null) {
			System.arraycopy(this.newCodeFormatter.scribe.mappedPositions, 0, positions, 0, positions.length);
		}
		return result;
	}

