	/** 
	 * Creates a new instance of Code Formatter using the given settings.
	 */
	public CodeFormatter(Map settings) {

		// initialize internal state
		constructionsCount = 0;
		constructions = new int[10];
		currentLineIndentationLevel = indentationLevel = initialIndentationLevel;
		currentCommentOffset = -1;

		// initialize primary and secondary scanners
		scanner = new Scanner(true, true); // regular scanner for forming lines
		scanner.recordLineSeparator = true;
		// to remind of the position of the beginning of the line.
		splitScanner = new Scanner(true, true);
		// secondary scanner to split long lines formed by primary scanning

		// initialize current line buffer
		currentLineBuffer = new StringBuffer();
		this.options = new FormatterOptions(settings);
	}

