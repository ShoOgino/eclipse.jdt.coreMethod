	/**
	 * @see org.eclipse.jdt.core.ICodeFormatter#format(java.lang.String, int, int, java.lang.String)
	 * TODO handle positions mapping
	 */
	public String format(String string, int[] positions, AstNode[] nodes) {
		// reset the scribe
		this.scribe.reset();
		
		long startTime = System.currentTimeMillis();

		final char[] compilationUnitSource = string.toCharArray();
		
		this.scribe.scanner.setSource(compilationUnitSource);
		this.localScanner.setSource(compilationUnitSource);
		this.scribe.scannerEndPosition = compilationUnitSource.length;
		this.scribe.scanner.resetTo(0, this.scribe.scannerEndPosition);
		if (nodes == null) {
			return string;
		}

		this.lastLocalDeclarationSourceStart = 0;
		try {
			if (nodes != null) {
				formatClassBodyDeclarations(nodes);
			}
		} catch(AbortFormatting e){
			return failedToFormat(compilationUnitSource);
		}
		if (DEBUG){
			System.out.println("Formatting time: " + (System.currentTimeMillis() - startTime));  //$NON-NLS-1$
		}
		return this.scribe.toString();
	}

