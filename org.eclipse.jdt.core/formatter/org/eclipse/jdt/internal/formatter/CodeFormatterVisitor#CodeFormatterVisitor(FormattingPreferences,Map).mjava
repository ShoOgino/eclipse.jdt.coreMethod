	public CodeFormatterVisitor(FormattingPreferences preferences, Map settings) {
		if (settings != null) {
			String compiler_source = (String) settings.get(JavaCore.COMPILER_SOURCE);
			if (compiler_source == null) {
				this.localScanner = ToolFactory.createScanner(false, false, false, false);
			} else {
				this.localScanner = ToolFactory.createScanner(false, false, false, compiler_source);
			}
		} else {
			this.localScanner = ToolFactory.createScanner(false, false, false, false);
		}
		// TODO set the java core options when common preferences are changed
//		convertOldOptionsToPreferences(settings, preferences);
		this.preferences = preferences;
		this.scribe = new Scribe(this, settings);
	}

