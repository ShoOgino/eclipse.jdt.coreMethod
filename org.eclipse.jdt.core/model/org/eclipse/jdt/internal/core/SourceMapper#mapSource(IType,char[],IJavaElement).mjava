	/**
	 * Maps the given source code to the given binary type and its children.
	 * If a non-null java element is passed, finds the name range for the 
	 * given java element without storing it.
	 */
	public ISourceRange mapSource(
		IType type,
		char[] contents,
		IJavaElement searchedElement) {
			
		fType = (BinaryType) type;
		
		// check whether it is already mapped
		if (this.fSourceRanges.get(type) != null) return (searchedElement != null) ? this.getNameRange(searchedElement) : null;
		
		this.importsTable.remove(fType);
		this.importsCounterTable.remove(fType);
		this.searchedElement = searchedElement;
		this.types = new IType[1];
		this.typeDeclarationStarts = new int[1];
		this.typeNameRanges = new SourceRange[1];
		this.typeDepth = -1;
		this.fMemberDeclarationStart = new int[1];
		this.fMemberName = new String[1];
		this.fMemberNameRange = new SourceRange[1];
		this.fMethodParameterTypes = new char[1][][];
		this.anonymousCounter = 0;
		
		Hashtable oldSourceRanges = (Hashtable) fSourceRanges.clone();
		try {
			IProblemFactory factory = new DefaultProblemFactory();
			SourceElementParser parser = null;
			boolean isAnonymousClass = false;
			try {
				isAnonymousClass = ((IBinaryType) fType.getRawInfo()).isAnonymous();
			} catch(JavaModelException e) {
			}
			if (isAnonymousClass) {
				try {
					this.anonymousClassName = Integer.parseInt(fType.getElementName());
				} catch(NumberFormatException e) {
				}
				parser = new SourceElementParser(this, factory, true);
			} else {
				parser = new SourceElementParser(this, factory);
			}
			parser.parseCompilationUnit(
				new BasicCompilationUnit(contents, type.getElementName() + ".java" ), //$NON-NLS-1$
				isAnonymousClass);
			if (searchedElement != null) {
				ISourceRange range = this.getNameRange(searchedElement);
				return range;
			} else {
				return null;
			}
		} finally {
			if (searchedElement != null) {
				fSourceRanges = oldSourceRanges;
			}
			fType = null;
			this.searchedElement = null;
			this.types = null;
			this.typeDeclarationStarts = null;
			this.typeNameRanges = null;
			this.typeDepth = -1;
		}
	}

