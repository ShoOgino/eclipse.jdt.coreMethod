	protected void saveClasspathIfNecessary() throws JavaModelException {
		
		if (!this.canChangeResource || !this.needSave) return;
				
		IClasspathEntry[] classpathForSave;
		JavaProject project = getProject();
		if (this.newRawPath == ReuseClasspath || this.newRawPath == UpdateClasspath){
			classpathForSave = project.getRawClasspath();
		} else {
			classpathForSave = this.newRawPath;
		}
		IPath outputLocationForSave;
		if (this.newOutputLocation == ReuseOutputLocation){
			outputLocationForSave = project.getOutputLocation();
		} else {
			outputLocationForSave = this.newOutputLocation;
		}
		// if read-only .classpath, then the classpath setting will never been performed completely
		if (project.saveClasspath(classpathForSave, outputLocationForSave)) {
			this.setAttribute("hasModifiedResource", "true"); //$NON-NLS-1$ //$NON-NLS-2$
		}
	}

