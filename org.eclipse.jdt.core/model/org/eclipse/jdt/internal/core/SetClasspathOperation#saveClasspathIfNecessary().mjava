	protected void saveClasspathIfNecessary() throws JavaModelException {
		
		if (!this.canChangeResource || !this.needSave) return;
				
		IClasspathEntry[] classpathForSave;
		JavaProject project = getProject();
		if (this.newRawPath == ReuseClasspath || this.newRawPath == UpdateClasspath){
			classpathForSave = project.getRawClasspath();
		} else {
			classpathForSave = this.newRawPath;
		}
		IPath outputLocationForSave;
		boolean isCleaningForSave;
		if (this.newOutputLocation == ReuseOutputLocation){
			outputLocationForSave = project.getOutputLocation();
			isCleaningForSave = project.isCleaningOutputLocation();
		} else {
			outputLocationForSave = this.newOutputLocation;
			isCleaningForSave = this.newIsCleaning;
		}
		// if read-only .classpath, then the classpath setting will never been performed completely
		if (project.saveClasspath(classpathForSave, outputLocationForSave, isCleaningForSave)) {
			this.setAttribute(HAS_MODIFIED_RESOURCE_ATTR, TRUE); 
		}
	}

