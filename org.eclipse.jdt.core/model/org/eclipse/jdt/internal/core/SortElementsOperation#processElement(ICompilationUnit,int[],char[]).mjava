	/**
	 * Method processElement.
	 * @param unit
	 * @param positionsToMap
	 * @param source
	 */
	private String processElement(ICompilationUnit unit, int[] positionsToMap, char[] source) {
		CompilerOptions options = new CompilerOptions(unit.getJavaProject().getOptions(true));
		SortElementBuilder builder = new SortElementBuilder(source, positionsToMap, this.comparator, options);
		SourceElementParser parser = new SourceElementParser(builder,
			ProblemFactory.getProblemFactory(Locale.getDefault()), options, true);
		
		if (unit.exists()) {
			PackageFragment packageFragment = (PackageFragment)unit.getAncestor(IJavaElement.PACKAGE_FRAGMENT);
			char[][] expectedPackageName = null;
			if (packageFragment != null){
				expectedPackageName = Util.toCharArrays(packageFragment.names);
			}
			parser.parseCompilationUnit(
				new BasicCompilationUnit(
					source,
					expectedPackageName,
					unit.getElementName(),
					unit),
				false/*diet parse*/);
		} else {
			parser.parseCompilationUnit(
				new BasicCompilationUnit(
					source,
					null,
					"",//$NON-NLS-1$
					unit.getJavaProject()),//$NON-NLS-1$
				false/*diet parse*/);
		}
		return builder.getSource();
	}

