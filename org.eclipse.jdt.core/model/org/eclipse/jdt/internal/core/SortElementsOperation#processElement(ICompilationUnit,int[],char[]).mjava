	/**
	 * Method processElement.
	 * @param unit
	 * @param positionsToMap
	 * @param source
	 */
	private String processElement(ICompilationUnit unit, int[] positionsToMap, char[] source) {
		SortElementBuilder builder = new SortElementBuilder(source, positionsToMap, this.comparator);
		SourceElementParser parser = new SourceElementParser(builder,
			ProblemFactory.getProblemFactory(Locale.getDefault()), new CompilerOptions(JavaCore.getOptions()), true);
		
		if (unit.exists()) {
			IPackageFragment packageFragment = (IPackageFragment)unit.getAncestor(IJavaElement.PACKAGE_FRAGMENT);
			char[][] expectedPackageName = null;
			if (packageFragment != null){
				expectedPackageName = CharOperation.splitOn('.', packageFragment.getElementName().toCharArray());
			}
			parser.parseCompilationUnit(
				new BasicCompilationUnit(
					source,
					expectedPackageName,
					unit.getElementName(),
//					null),
					unit),
				false/*diet parse*/);
		} else {
			parser.parseCompilationUnit(
				new BasicCompilationUnit(
					source,
					null,
					"",//$NON-NLS-1$
//					null),
					unit.getJavaProject()),//$NON-NLS-1$
				false/*diet parse*/);
		}
		return builder.getSource();
	}

