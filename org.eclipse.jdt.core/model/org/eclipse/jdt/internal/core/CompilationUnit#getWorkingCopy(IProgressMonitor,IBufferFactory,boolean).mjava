/**
 * @see IWorkingCopy
 */
public IJavaElement getWorkingCopy(IProgressMonitor pm, IBufferFactory factory, boolean isManaged) throws JavaModelException {
	WorkingCopy workingCopy;
	Map managedWorkingCopies = null;
	JavaModelManager manager = null;
	if (isManaged) {
		manager = JavaModelManager.getJavaModelManager();
		managedWorkingCopies = manager.managedWorkingCopies;
		workingCopy = (WorkingCopy)managedWorkingCopies.get(this);
		if (workingCopy != null) {
			workingCopy.managedCount++;
			return workingCopy;
		}
	}
	workingCopy = new WorkingCopy((IPackageFragment)getParent(), getElementName(), factory);
	// open the working copy now to ensure contents are that of the current state of this element
	IBuffer buffer = factory == null ? null : factory.createBuffer(workingCopy);
	workingCopy.open(pm, buffer);
	if (isManaged) {
		managedWorkingCopies.put(this, workingCopy);

		// report added java delta
		JavaElementDelta delta = new JavaElementDelta(this.getJavaModel());
		delta.added(workingCopy);
		manager.registerJavaModelDelta(delta);
		manager.fire();
		
	}
	return workingCopy;
}

