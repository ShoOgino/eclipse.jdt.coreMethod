	/**
	 * Get all secondary types for a project and store result in per project info cache.
	 * 
	 * @param project Project we want get secondary types from
	 * @return HashMap Table of secondary type names->path for given project
	 */
	public HashMap getSecondaryTypes(IJavaProject project, boolean waitForIndexes, IProgressMonitor monitor) throws JavaModelException {
		if (VERBOSE) {
			StringBuffer buffer = new StringBuffer("JavaModelManager.getSecondaryTypesPaths("); //$NON-NLS-1$
			buffer.append(project.getElementName());
			buffer.append(')');
			Util.verbose(buffer.toString());
		}

		// Wait the end of indexing if requested
		final PerProjectInfo projectInfo = getPerProjectInfoCheckExistence(project.getProject());
		IndexManager manager = getIndexManager();
		boolean indexing = manager.awaitingJobsCount() > 0;
		if (indexing && waitForIndexes) {
			while (manager.awaitingJobsCount() > 0) {
				if (monitor != null && monitor.isCanceled()) {
					if (projectInfo.secondaryTypes == null) return NO_SECONDARY_TYPES;
					return projectInfo.secondaryTypes;
				}
				try {
					Thread.sleep(10);
				} catch (InterruptedException e) {
					if (projectInfo.secondaryTypes == null) return NO_SECONDARY_TYPES;
					return projectInfo.secondaryTypes;
				}
			}
		}

		// Return cache if not empty and not dirty
		if (projectInfo.secondaryTypes != null && projectInfo.secondaryTypes.get(DIRTY_CACHE) == null) {
			return projectInfo.secondaryTypes;
		}
		
		// Return cache if not waiting for indexing
		if (indexing && !waitForIndexes) {
			if (projectInfo.secondaryTypes == null) {
				return NO_SECONDARY_TYPES; // cache is not initialized return empty one
			}
			return projectInfo.secondaryTypes; // cache is dirty => return current one...
		}

		// Init variables for search
		final HashMap secondaryTypes = new HashMap(3);
		IRestrictedAccessTypeRequestor nameRequestor = new IRestrictedAccessTypeRequestor() {
			public void acceptType(int modifiers, char[] packageName, char[] simpleTypeName, char[][] enclosingTypeNames, String path, AccessRestriction access) {
				String key = packageName==null ? "" : new String(packageName); //$NON-NLS-1$
				HashMap types = (HashMap) secondaryTypes.get(key);
				if (types == null) types = new HashMap(3);
				types.put(new String(simpleTypeName), path);
				secondaryTypes.put(key, types);
			}
		};

		// Build scope using prereq projects but only source folders
		IPackageFragmentRoot[] allRoots = project.getAllPackageFragmentRoots();
		int length = allRoots.length, size = 0;
		IPackageFragmentRoot[] allSourceFolders = new IPackageFragmentRoot[length];
		for (int i=0; i<length; i++) {
			if (allRoots[i].getKind() == IPackageFragmentRoot.K_SOURCE) {
				allSourceFolders[size++] = allRoots[i];
			}
		}
		if (size < length) {
			System.arraycopy(allSourceFolders, 0, allSourceFolders = new IPackageFragmentRoot[size], 0, size);
		}

		// Search all secondary types on scope
		new BasicSearchEngine().searchAllSecondaryTypeNames(allSourceFolders, nameRequestor, monitor);
		if (VERBOSE) {
			System.out.print(Thread.currentThread() + "	-> secondary paths: ");  //$NON-NLS-1$
			System.out.println();
			Iterator keys = secondaryTypes.keySet().iterator();
			while (keys.hasNext()) {
				String qualifiedName = (String) keys.next();
				Util.verbose("		- "+qualifiedName+'-'+secondaryTypes.get(qualifiedName) ); //$NON-NLS-1$
			}
		}

		// Build types from paths
		Iterator packages = secondaryTypes.keySet().iterator();
		while (packages.hasNext()) {
			String packName = (String) packages.next();
			HashMap types = (HashMap) secondaryTypes.get(packName);
			Iterator names = types.keySet().iterator();
			while (names.hasNext()) {
				String typeName = (String) names.next();
				String path = (String) types.get(typeName);
				if (org.eclipse.jdt.internal.core.util.Util.isJavaLikeFileName(path)) {
					IFile file = ResourcesPlugin.getWorkspace().getRoot().getFile(new Path(path));
					ICompilationUnit unit = JavaModelManager.createCompilationUnitFrom(file, null);
					IType type = unit.getType(typeName);
					types.put(typeName, type); // replace stored path with type itself
				}
			}
		}

		// Store result in per project info cache if still null or dirty (may have been set by another thread...)
		if (projectInfo.secondaryTypes == null || projectInfo.secondaryTypes.get(DIRTY_CACHE) != null) {
			projectInfo.secondaryTypes = secondaryTypes;
		}
		return projectInfo.secondaryTypes;
	}

