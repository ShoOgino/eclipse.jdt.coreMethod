protected void finishedWith(String sourceLocation, CompilationResult result, char[] mainTypeName, ArrayList definedTypeNames, ArrayList duplicateTypeNames) throws CoreException {
	char[][] previousTypeNames = newState.getDefinedTypeNamesFor(sourceLocation);
	if (previousTypeNames == null)
		previousTypeNames = new char[][] {mainTypeName};
	if (previousTypeNames.length > 0) {
		IPath packagePath = null;
		next : for (int i = 0, x = previousTypeNames.length; i < x; i++) {
			char[] previous = previousTypeNames[i];
			for (int j = 0, y = definedTypeNames.size(); j < y; j++)
				if (CharOperation.equals(previous, (char[]) definedTypeNames.get(j)))
					continue next;
	
			if (packagePath == null)
				packagePath = new Path(extractTypeNameFrom(sourceLocation)).removeLastSegments(1);
			removeClassFile(packagePath.append(new String(previous)));
		}
	} else if (!definedTypeNames.isEmpty()) { // added a type to an empty file
		IPath typePath = new Path(extractTypeNameFrom(sourceLocation));
		if (JavaBuilder.DEBUG)
			System.out.println("Add dependents of changed empty source file " + typePath); //$NON-NLS-1$
		addDependentsOf(typePath, true);
	}
	super.finishedWith(sourceLocation, result, mainTypeName, definedTypeNames, duplicateTypeNames);
}

