	private synchronized ArrayList getFoldersToCleanUp(IProgressMonitor monitor) throws CoreException {
		DeltaProcessingState state = JavaModelManager.getDeltaState();
		HashMap roots = state.roots;
		HashMap sourceAttachments = state.sourceAttachments;
		if (roots == null && sourceAttachments == null)
			return null;
		HashMap knownFolders = getFolders();
		Iterator iterator = knownFolders.keySet().iterator();
		ArrayList result = null;
		while (iterator.hasNext()) {
			IPath path = (IPath) iterator.next();
			if ((roots != null && !roots.containsKey(path))
					&& (sourceAttachments != null && !sourceAttachments.containsKey(path))) {
				IFolder folder = (IFolder) knownFolders.get(path);
				if (folder != null) {
					if (result == null)
						result = new ArrayList();
					result.add(folder);
				}
			}
		}
		return result;
	}

