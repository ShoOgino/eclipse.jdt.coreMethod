/**
 * Returns the DOM with the new source to use for the given compilation unit.
 */
protected void generateNewCompilationUnitDOM(ICompilationUnit cu) throws JavaModelException {
	IBuffer buffer = cu.getBuffer();
	if (buffer == null) return;
	char[] prevSource = buffer.getCharacters();
	if (prevSource == null) return;

	// create a JDOM for the compilation unit
	fCUDOM = (new DOMFactory()).createCompilationUnit(prevSource, cu.getElementName());
	IDOMNode child = generateElementDOM();
	if (child != null) {
		insertDOMNode(fCUDOM, child);
	}
	worked(1);
}

