	/*
	 * Registers the given action to be run when the outer most java model operation has finished.
	 * The insertion mode controls whether:
	 * - the action should replace the last exiting action with the same id (REPLACE_LAST),
	 * - the action should be ignored if there is already an action with the same id (KEEP_EXISTING),
	 * - the action should be registered without looking at existing actions (DEFAULT)	 */
	protected void postAction(IPostAction action, int insertionMode) {
		JavaModelOperation outerMostOp = (JavaModelOperation)getCurrentOperationStack().get(0);
		if (outerMostOp.actions == null) {
			outerMostOp.actions = new IPostAction[1];
			outerMostOp.actions[0] = action;
			outerMostOp.actionsPtr++;
		} else {
			String id = action.getID();
			switch (insertionMode) {
				case REPLACE_LAST :
					int existing = outerMostOp.lastActionWithID(id);
					if (existing != -1) {
						outerMostOp.actions[existing] = action;
					} else {
						outerMostOp.addAction(action);
					}
					break;
				case KEEP_EXISTING:
					existing = outerMostOp.lastActionWithID(id);
					if (existing == -1) {
						outerMostOp.addAction(action);
					}
					break;
				case DEFAULT:
					outerMostOp.addAction(action);
					break;
			}
		}
	}

