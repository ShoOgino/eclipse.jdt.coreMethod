	/*
	 * Registers the given action to be run when the outer most java model operation has finished.
	 * The insertion mode controls whether:
	 * - the action should discard all existing actions with the same id, and be queued at the end (REMOVEALL_APPEND),
	 * - the action should be ignored if there is already an action with the same id (KEEP_EXISTING),
	 * - the action should be queued at the end without looking at existing actions (APPEND)	 */
	protected void postAction(IPostAction action, int insertionMode) {
		JavaModelOperation outerMostOp = (JavaModelOperation)getCurrentOperationStack().get(0);
		IPostAction[] postActions = outerMostOp.actions;
		if (postActions == null) {
			outerMostOp.actions = postActions = new IPostAction[1];
			postActions[0] = action;
			outerMostOp.actionsPtr++;
		} else {
			String id = action.getID();
			switch (insertionMode) {
				case REMOVEALL_APPEND :
					int index = -1;
					while ((index = outerMostOp.firstActionWithID(id, index+1)) >= 0) {
						// remove action[index]
						System.arraycopy(postActions, index+1, postActions, index, outerMostOp.actionsPtr - index);
						postActions[outerMostOp.actionsPtr--] = null;
					}
					outerMostOp.addAction(action);
					break;
				case KEEP_EXISTING:
					if (outerMostOp.firstActionWithID(id, 0) < 0) {
						outerMostOp.addAction(action);
					}
					break;
				case APPEND:
					outerMostOp.addAction(action);
					break;
			}
		}
	}

