protected boolean writeClassFileCheck(IFile file, String fileName, byte[] newBytes) throws CoreException {
	try {
		byte[] oldBytes = Util.getResourceContentsAsByteArray(file);
		if (this.compileLoop > 1) { // only optimize files which were recompiled during the dependent pass
			notEqual : if (newBytes.length == oldBytes.length) {
				for (int i = newBytes.length; --i >= 0;)
					if (newBytes[i] != oldBytes[i]) break notEqual;
				return false; // bytes are identical so skip them
			}
		}
		IPath location = file.getLocation();
		if (location == null) return false; // unable to determine location of this class file
		ClassFileReader reader = new ClassFileReader(oldBytes, location.toString().toCharArray());
		// ignore local types since they're only visible inside a single method
		if (!(reader.isLocal() || reader.isAnonymous()) && reader.hasStructuralChanges(newBytes)) {
			if (JavaBuilder.DEBUG)
				System.out.println("Type has structural changes " + fileName); //$NON-NLS-1$
			addDependentsOf(new Path(fileName), true);
		}
	} catch (ClassFormatException e) {
		addDependentsOf(new Path(fileName), true);
	}
	return true;
}

