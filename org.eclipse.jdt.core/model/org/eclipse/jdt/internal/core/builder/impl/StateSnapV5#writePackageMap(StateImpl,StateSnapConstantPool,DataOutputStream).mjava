/** 
 * Write the package map.
 */
protected void writePackageMap(StateImpl state, StateSnapConstantPool pool, DataOutputStream out) throws IOException {
	out.writeUTF("PackageMap");
	PackageMap map = state.getPackageMap();
	out.writeInt(map.size());
	int count = 0;
	for (Enumeration e = map.getAllPackages(); e.hasMoreElements(); ) {
		++count;
		IPackage pkg = (IPackage)e.nextElement();
		IPath[] fragments = map.getFragments(pkg);
		out.writeInt(pool.index(pkg));
		out.writeShort(fragments.length);
		for (int i = 0; i < fragments.length; ++i) {
			out.writeInt(pool.index(fragments[i]));
		}
	}
	Assert.isTrue(count == map.size()); // Sanity check
}

