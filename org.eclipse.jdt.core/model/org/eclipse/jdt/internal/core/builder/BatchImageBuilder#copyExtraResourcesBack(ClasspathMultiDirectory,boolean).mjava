protected void copyExtraResourcesBack(ClasspathMultiDirectory sourceLocation, final boolean deletedAll) throws CoreException {
	// When, if ever, does a builder need to copy resources files (not .java or .class) into the output folder?
	// If we wipe the output folder at the beginning of the build then all 'extra' resources must be copied to the output folder.

	notifier.subTask(Util.bind("build.copyingResources")); //$NON-NLS-1$
	final int segmentCount = sourceLocation.sourceFolder.getFullPath().segmentCount();
	final char[][] exclusionPatterns = sourceLocation.exclusionPatterns;
	final IContainer outputFolder = sourceLocation.binaryFolder;
	sourceLocation.sourceFolder.accept(
//		new IResourceProxyVisitor() {
//			public boolean visit(IResourceProxy proxy) throws CoreException {
//				IResource resource = null;
//				switch(proxy.getType()) {
//						if (Util.isJavaFileName(proxy.getName()) || Util.isClassFileName(proxy.getName())) return false;
//
//						resource = proxy.requestResource();
//						if (javaBuilder.filterExtraResource(resource)) return false;
//						if (exclusionPatterns != null && Util.isExcluded(resource, exclusionPatterns))
//							return false;
//
//						IPath partialPath = resource.getFullPath().removeFirstSegments(segmentCount);
//						IResource copiedResource = outputFolder.getFile(partialPath);
//						if (copiedResource.exists()) {
//							if (deletedAll) {
//								createErrorFor(resource, Util.bind("build.duplicateResource")); //$NON-NLS-1$
//								return false;
//							}
//							copiedResource.delete(IResource.FORCE, null); // last one wins
//						}
//						resource.copy(copiedResource.getFullPath(), IResource.FORCE, null);
//						copiedResource.setDerived(true);
//						return false;
//					case IResource.FOLDER :
//						resource = proxy.requestResource();
//						if (resource.equals(outputFolder)) return false;
//						if (javaBuilder.filterExtraResource(resource)) return false;
//						if (exclusionPatterns != null && Util.isExcluded(resource, exclusionPatterns))
//							return false;
//
//						createFolder(resource.getFullPath().removeFirstSegments(segmentCount), outputFolder);
//				}
//				return true;
//			}
//		}
		new IResourceVisitor() {
			public boolean visit(IResource resource) throws CoreException {
				switch(resource.getType()) {
					case IResource.FILE :
						if (Util.isJavaFileName(resource.getName()) || Util.isClassFileName(resource.getName())) return false;
						if (javaBuilder.filterExtraResource(resource)) return false;
						if (exclusionPatterns != null && Util.isExcluded(resource, exclusionPatterns))
							return false;

						IPath partialPath = resource.getFullPath().removeFirstSegments(segmentCount);
						IResource copiedResource = outputFolder.getFile(partialPath);
						if (copiedResource.exists()) {
							if (deletedAll) {
								createErrorFor(resource, Util.bind("build.duplicateResource")); //$NON-NLS-1$
								return false;
							}
							copiedResource.delete(IResource.FORCE, null); // last one wins
						}
						resource.copy(copiedResource.getFullPath(), IResource.FORCE, null);
						copiedResource.setDerived(true);
						return false;
					case IResource.FOLDER :
						if (resource.equals(outputFolder)) return false;
						if (javaBuilder.filterExtraResource(resource)) return false;
						if (exclusionPatterns != null && Util.isExcluded(resource, exclusionPatterns))
							return false;

						createFolder(resource.getFullPath().removeFirstSegments(segmentCount), outputFolder);
				}
				return true;
			}
		}
	);
}

