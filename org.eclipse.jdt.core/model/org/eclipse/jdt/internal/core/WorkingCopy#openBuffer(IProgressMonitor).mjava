/**
 * @see Openable
 */
protected IBuffer openBuffer(IProgressMonitor pm) throws JavaModelException {

	// create buffer - working copies may use custom buffer factory
	IBuffer buffer = getBufferFactory().createBuffer(this);
	this.getBufferManager().addBuffer(buffer);

	// set the buffer source
	if (buffer != null && buffer.getCharacters() == null){
		ICompilationUnit original= (ICompilationUnit)this.getOriginalElement();
		buffer.setContents((char[])original.getBuffer().getCharacters().clone());
	}

	// listen to buffer changes
	buffer.addBufferChangedListener(this);

	return buffer;	
}

