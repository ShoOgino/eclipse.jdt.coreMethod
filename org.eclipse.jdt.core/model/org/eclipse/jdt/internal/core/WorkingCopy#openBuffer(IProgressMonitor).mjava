/**
 * @see Openable
 */
protected IBuffer openBuffer(IProgressMonitor pm) throws JavaModelException {

	// get buffer factory
	BufferManager bufManager = getBufferManager();
	IBufferFactory factory = 
		this.bufferFactory == null ? 
			bufManager.getDefaultBufferFactory() :
			this.bufferFactory;
			
	// create buffer
	IBuffer buffer = factory.createBuffer(this);
	bufManager.addBuffer(buffer);

	// set the buffer source
	if (buffer != null && buffer.getCharacters() == null){
		ICompilationUnit original= (ICompilationUnit)this.getOriginalElement();
		buffer.setContents((char[])original.getBuffer().getCharacters().clone());
	}

	// listen to buffer changes
	buffer.addBufferChangedListener(this);

	return buffer;	
}

