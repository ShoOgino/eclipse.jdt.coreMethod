	/**
	 * Execute the operation - generate new source for the compilation unit
	 * and save the results.
	 *
	 * @exception JavaModelException if the operation is unable to complete
	 */
	protected void executeOperation() throws JavaModelException {
		beginTask(getMainTaskName(), getMainAmountOfWork());
		JavaElementDelta delta = newJavaElementDelta();
		ICompilationUnit unit = getCompilationUnit();
		generateNewCompilationUnitDOM(unit);
		if (fCreationOccurred) {
			//a change has really occurred
			Buffer buffer = (Buffer) unit.getBuffer();
			switch (fReplacementLength) {
				case -1 :
					// element is append at the end
					buffer.append(fCreatedElement.getCharacters(), true);
					break;
				case 0 :
					// element is inserted
					buffer.replace(fInsertionPosition, 0, fCreatedElement.getCharacters(), true);
					break;
				default :
					// element is replacing the previous one
					buffer.replace(
						fInsertionPosition,
						fReplacementLength,
						fCreatedElement.getCharacters(),
						true);
			}
			unit.save(null, false);
			worked(1);
			fResultElements = generateResultHandles();
			for (int i = 0; i < fResultElements.length; i++) {
				delta.added(fResultElements[i]);
			}
			addDelta(delta);
		}
		done();
	}

