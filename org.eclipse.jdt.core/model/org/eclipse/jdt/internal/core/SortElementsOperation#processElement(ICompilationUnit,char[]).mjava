	/**
	 * Method processElement.
	 * @param unit
	 * @param bufferContents
	 */
	private void processElement(ICompilationUnit unit, char[] source) throws JavaModelException {
		SortElementBuilder builder = new SortElementBuilder(source, comparator);
		SourceElementParser parser = new SourceElementParser(builder,
			ProblemFactory.getProblemFactory(Locale.getDefault()), new CompilerOptions(JavaCore.getOptions()), true);
		
		IPackageFragment packageFragment = (IPackageFragment)unit.getAncestor(IJavaElement.PACKAGE_FRAGMENT);
		char[][] expectedPackageName = null;
		if (packageFragment != null){
			expectedPackageName = CharOperation.splitOn('.', packageFragment.getElementName().toCharArray());
		}
		parser.parseCompilationUnit(
			new BasicCompilationUnit(
				source,
				expectedPackageName,
				unit.getElementName(),
				unit.getJavaProject().getOption(JavaCore.CORE_ENCODING, true)),
			false);
		worked(1);
		unit.getBuffer().setContents(builder.getSource());
		worked(1);
	}

