/**
 * Sets the output location of the pre-specified project.
 *
 * <p>This can cause changes in package fragments - i.e. if the
 * old and new output location folder could be considered as
 * a package fragment.
 */
protected void executeOperation() throws JavaModelException {
	beginTask(Util.bind("classpath.settingOutputLocationProgress"/*nonNLS*/), 2);
	JavaProject project= ((JavaProject) getElementsToProcess()[0]);
	
	IPath oldLocation= project.getOutputLocation();
	IPath newLocation= fOutputLocation;

	// see if this will cause any package fragments to be added
	boolean deltaToFire= false;
	JavaElementDelta delta = newJavaElementDelta();
	Vector added= determineAffectedPackageFragments(oldLocation);
	Enumeration pkgs= added.elements();
	while (pkgs.hasMoreElements()) {
		IPackageFragment frag= (IPackageFragment)pkgs.nextElement();
		((IPackageFragmentRoot)frag.getParent()).close();
		delta.added(frag);
		deltaToFire = true;
	}

	// see if this will cause any package fragments to be removed
	Vector removed= determineAffectedPackageFragments(newLocation);
	pkgs= removed.elements();
	while (pkgs.hasMoreElements()) {
		IPackageFragment frag= (IPackageFragment)pkgs.nextElement();
		((IPackageFragmentRoot)frag.getParent()).close();
		delta.removed(frag);
		deltaToFire = true;
	}
	
	project.setOutputLocation0(fOutputLocation);
	if (deltaToFire) {
		addDelta(delta);	
	}
	worked(1);
	project.saveClasspath();
	worked(1);

	// loose all built state - next build will be a full one
	JavaModelManager.getJavaModelManager().setLastBuiltState(project.getProject(), null);
	done();
}

