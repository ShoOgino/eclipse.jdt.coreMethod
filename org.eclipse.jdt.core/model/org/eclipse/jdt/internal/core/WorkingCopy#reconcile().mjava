/**
 * @see IWorkingCopy
 */ 
public IMarker[] reconcile() throws JavaModelException {

	// create the delta builder (this remembers the current content of the cu)
	JavaElementDeltaBuilder deltaBuilder = new JavaElementDeltaBuilder(this);

	// update the element infos with the content of the working copy
	if (this.problemRequestor != null) this.problemRequestor.clear();
	this.makeConsistent(this.problemRequestor, this.problemRequestor != null, null);
	//if (this.problemRequestor != null) this.problemRequestor.done();

	// build the deltas
	deltaBuilder.buildDeltas();
	
	// fire the deltas
	boolean shouldFire = false;
	JavaModelManager manager = null;
	if (deltaBuilder.delta != null) {
		manager = (JavaModelManager)JavaModelManager.getJavaModelManager();
		if (deltaBuilder.delta.getAffectedChildren().length > 0) {
			manager.registerJavaModelDelta(deltaBuilder.delta);
			shouldFire = true;
		}
	}
	if (shouldFire) manager.fire();

	return null;
}

