	/**
	 * Disassemble the class file reader.
	 */
	public String disassemble(IClassFileReader classFileReader, String lineSeparator, int mode) {
		if (classFileReader == null) return EMPTY_OUTPUT;
		
		StringBuffer buffer = new StringBuffer();

		if (mode == IClassFileDisassembler.DETAILED) {
			int minorVersion = classFileReader.getMinorVersion();
			int majorVersion = classFileReader.getMajorVersion();
			buffer.append(Util.bind("classfileformat.magicnumber")); //$NON-NLS-1$
			buffer.append(Integer.toHexString(classFileReader.getMagic()).toUpperCase());
			writeNewLine(buffer, lineSeparator, 0);
			buffer.append(Util.bind("classfileformat.minorversion")); //$NON-NLS-1$
			buffer.append(minorVersion);
			writeNewLine(buffer, lineSeparator, 0);
			buffer.append(Util.bind("classfileformat.majorversion")); //$NON-NLS-1$
			buffer.append(majorVersion);
			writeNewLine(buffer, lineSeparator, 0);
			if (minorVersion == 3 && majorVersion == 45) {
				buffer.append(Util.bind("classfileformat.targetoption") +" 1.1");//$NON-NLS-1$//$NON-NLS-2$
			} else if (minorVersion == 0 && majorVersion == 46) {
				buffer.append(Util.bind("classfileformat.targetoption") + "1.2");//$NON-NLS-1$//$NON-NLS-2$
			} else if (minorVersion == 0 && majorVersion == 47) {
				buffer.append(Util.bind("classfileformat.targetoption") + "1.3");//$NON-NLS-1$//$NON-NLS-2$
			} else if (minorVersion == 0 && majorVersion == 48) {
				buffer.append(Util.bind("classfileformat.targetoption") + "1.4");//$NON-NLS-1$//$NON-NLS-2$
			}
			writeNewLine(buffer, lineSeparator, 0);
			writeNewLine(buffer, lineSeparator, 0);
		}
		ISourceAttribute sourceAttribute = classFileReader.getSourceFileAttribute();
		if (sourceAttribute != null) {
			buffer.append(Util.bind("classfileformat.sourcename")); //$NON-NLS-1$
			buffer.append(sourceAttribute.getSourceFileName());
			writeNewLine(buffer, lineSeparator, 0);
		}
		char[] className = classFileReader.getClassName();
		if (className == null) {
			// incomplete initialization. We cannot go further.
			return buffer.toString();
		}
		decodeModifiersForType(buffer, classFileReader.getAccessFlags());
		if (classFileReader.isClass()) {
			buffer.append(Util.bind("classfileformat.class")); //$NON-NLS-1$
		} else {
			buffer.append(Util.bind("classfileformat.interface")); //$NON-NLS-1$
		}
		CharOperation.replace(className, '/', '.');
		buffer.append(className);
		
		char[] superclassName = classFileReader.getSuperclassName();
		if (superclassName != null) {
			buffer.append(Util.bind("classfileformat.extends")); //$NON-NLS-1$
			CharOperation.replace(superclassName, '/', '.');
			buffer.append(superclassName);
		}
		char[][] superclassInterfaces = classFileReader.getInterfaceNames();
		int length = superclassInterfaces.length;
		if (length != 0) {
			buffer.append(Util.bind("classfileformat.implements")); //$NON-NLS-1$
			for (int i = 0; i < length - 1; i++) {
				char[] superinterface = superclassInterfaces[i];
				CharOperation.replace(superinterface, '/', '.');
				buffer
					.append(superinterface)
					.append(Util.bind("disassembler.comma")); //$NON-NLS-1$
			}
			char[] superinterface = superclassInterfaces[length - 1];
			CharOperation.replace(superinterface, '/', '.');
			buffer.append(superinterface);
		}
		buffer.append(Util.bind("disassembler.opentypedeclaration")); //$NON-NLS-1$
		checkSuperFlags(buffer, classFileReader.getAccessFlags(), lineSeparator, 1);
		disassembleTypeMembers(classFileReader, buffer, lineSeparator, 1, mode);
		if (mode == IClassFileDisassembler.DETAILED) {
			IInnerClassesAttribute innerClassesAttribute = classFileReader.getInnerClassesAttribute();
			if (innerClassesAttribute != null) {
				disassemble(innerClassesAttribute, buffer, lineSeparator, 1);
			}
			IClassFileAttribute[] attributes = classFileReader.getAttributes();
			length = attributes.length;
			if (length != 0) {
				for (int i = 0; i < length; i++) {
					IClassFileAttribute attribute = attributes[i];
					if (attribute != innerClassesAttribute
						&& attribute != sourceAttribute) {
						disassemble(attribute, buffer, lineSeparator, 0);
					}
				}
			}		
		}
		writeNewLine(buffer, lineSeparator, 0);
		buffer.append(Util.bind("disassembler.closetypedeclaration")); //$NON-NLS-1$
		return buffer.toString();
	}

