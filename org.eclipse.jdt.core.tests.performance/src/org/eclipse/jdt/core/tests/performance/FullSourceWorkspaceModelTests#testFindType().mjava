/*
 * Performance test for the first use of findType(...)
 * (see bug 161175 JarPackageFragmentRoot slow to initialize)
 */
public void testFindType() throws CoreException {
	
	// get 20 projects
	IJavaModel model = JavaCore.create(ResourcesPlugin.getWorkspace().getRoot());
	int max = 20;
	IJavaProject[] projects = new IJavaProject[max];
	for (int i = 0; i < max; i++) {
		projects[i] = createJavaProject("FindType" + i);
	}
	AbstractJavaModelTests.waitUntilIndexesReady();
	AbstractJavaModelTests.waitForAutoBuild();
	
	try {
		// warm up
		for (int i = 0; i < 5; i++) {
			model.close();
			for (int j = 0; j < max; j++) {
				projects[j].findType("java.lang.Object");
			}
		}
			
		// measure performance
		for (int i = 0; i < 10; i++) {
			model.close();
			runGc();
			startMeasuring();
			for (int j = 0; j < max; j++) {
				projects[j].findType("java.lang.Object");
			}
			stopMeasuring();
		}
	
		commitMeasurements();
		assertPerformance();
	} finally {
		for (int i = 0; i < max; i++) {
			projects[i].getProject().delete(false, null);
		}
	}
}

