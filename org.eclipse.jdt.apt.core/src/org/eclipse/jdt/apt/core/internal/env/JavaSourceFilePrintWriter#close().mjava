    public void close()
    {
    	String contents = _sw.toString();
        super.close();
        GeneratedFileManager gfm = GeneratedFileManager.getGeneratedFileManager(_env.getProject());
        Phase phase = _env.getPhase();
	
        if ( phase == Phase.RECONCILE )
        {
        	ICompilationUnit parentCompilationUnit = _env.getCompilationUnit();
            FileGenerationResult result  = gfm.generateFileDuringReconcile( 
                parentCompilationUnit, _typeName, contents, parentCompilationUnit.getOwner(), null, null );
			if ( result != null )
				_env.addGeneratedFile(result.getFile(), result.isModified());
        }
        else if ( phase == Phase.BUILD)	
        {
        	try {
				FileGenerationResult result = gfm.generateFileDuringBuild( 
						_env.getFile(),  _typeName, contents, _env, null /* progress monitor */ );
				if( result != null ){		
					_env.addGeneratedFile( result.getFile(), result.isModified());
					// don't set to false, we don't want to overwrite a previous iteration setting it to true
					if ( result.getSourcePathChanged() )
						_env.setSourcePathChanged( true );
				}
        	}
        	catch (CoreException ce) {
        		AptPlugin.log(ce, "Failure generating file"); //$NON-NLS-1$
        	}
        }
        else
        {
            assert false : "Unexpected phase value: " + phase ; //$NON-NLS-1$
        }
    }

