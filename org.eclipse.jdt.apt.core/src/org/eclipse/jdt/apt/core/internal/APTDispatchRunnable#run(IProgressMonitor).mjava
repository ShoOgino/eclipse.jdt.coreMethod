	public void run(IProgressMonitor monitor) 
	{	
		if ( !shouldProcess() )
		{
			// tracing
			if ( AptPlugin.DEBUG ) 
			{			
				String msg;
				if ( (_factories == null || _factories.size() == 0) && _dispatchedBatchFactories.isEmpty() )
					msg = "no AnnotationProcessoryFactory instances registered."; //$NON-NLS-1$
				else
					msg = "no files to dispatch to."; //$NON-NLS-1$
				trace( "run():  leaving early because there are " + msg, //$NON-NLS-1$
					   null);
			}

			Set<IFile> allDeletedFiles = new HashSet<IFile>();
			if( !_isFullBuild ){
				for( int i=0, len = _allFilesRequireProcessing.length; i<len; i++ ){
					IFile f = _allFilesRequireProcessing[i];
					final Set<IFile> deletedFiles = 
						cleanupAllGeneratedFilesForParent( f, _compilationUnit, null );
					if( deletedFiles != null )
						allDeletedFiles.addAll(deletedFiles);
				}
				for( int i=0, len=_remainingFiles.length; i<len; i++ ){
					IFile f = _remainingFiles[i];
					final Set<IFile> deletedFiles = 
						cleanupAllGeneratedFilesForParent( f, _compilationUnit, null );
					if( deletedFiles != null )
						allDeletedFiles.addAll(deletedFiles);
				}
			}
			
			if ( allDeletedFiles.size() == 0 )
				_result =  EMPTY_APT_RESULT;
			else
				_result = new APTResult( Collections.<IFile>emptySet(), 
										 allDeletedFiles,
										 Collections.<AnnotationProcessorFactory>emptySet(),
										 Collections.<IFile, Set<String>>emptyMap(),
										 Collections.<IFile, List<IProblem>>emptyMap(), 
										 false, false );
		}
		else
		{
			ProcessorEnvImpl processorEnv;
			
			if ( _compilationUnit != null )
			{
				processorEnv = ProcessorEnvImpl
					.newReconcileEnv(_compilationUnit, _javaProject);
			}
			else
			{
				processorEnv = ProcessorEnvImpl
					.newBuildEnv( _allFilesRequireProcessing, _remainingFiles, _javaProject);
			}
			if( processorEnv == null )
				_result =  EMPTY_APT_RESULT;
			else
				_result = runAPT(_factories, processorEnv);
		}
	}

