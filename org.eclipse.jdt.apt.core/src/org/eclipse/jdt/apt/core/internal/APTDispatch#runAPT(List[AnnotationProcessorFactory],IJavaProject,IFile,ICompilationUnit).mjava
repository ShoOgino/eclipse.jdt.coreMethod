	private static APTResult runAPT(final List<AnnotationProcessorFactory> factories,
			IJavaProject javaProj, IFile file, 
			ICompilationUnit compilationUnit )
	{
		
		APTDispatchRunnable runnable;
		ISchedulingRule schedulingRule;
		if ( file != null )
		{
			 runnable = new APTDispatchRunnable( file, javaProj, factories );
			 schedulingRule = javaProj.getResource();
		}
		else
		{
			runnable = new APTDispatchRunnable( compilationUnit, javaProj, factories );
			schedulingRule = null;
		}
		
		try
		{
			IWorkspace w = ResourcesPlugin.getWorkspace();
			w.run( runnable, schedulingRule, IWorkspace.AVOID_UPDATE, null );
		}
		catch( CoreException ce )
		{
			// TODO:  deal with this exception
			ce.printStackTrace();
		}
			
		return runnable.getResult();
	}

