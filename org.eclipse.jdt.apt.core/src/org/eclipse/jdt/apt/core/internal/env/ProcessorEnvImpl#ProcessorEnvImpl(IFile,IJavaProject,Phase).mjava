    private ProcessorEnvImpl( IFile file, IJavaProject javaProj, Phase phase )
    {
        assert phase == Phase.BUILD : "Unexpected phase value.  Use Phase.BUILD instead of " + phase;

    	_compilationUnit = null;

		char[] source = null;

		try
		{
			source = getFileContents( file );
		}
		catch( Exception e )
		{
			// TODO:  propagate these exceptions out of APTDispatch
			e.printStackTrace();
		}

		_source = source;
		assert _source != null : "missing source";

		String unitName = file.getProjectRelativePath().toString();
		ASTNode node = createDietAST( unitName, javaProj, null, _source );
		_astCompilationUnit = (org.eclipse.jdt.core.dom.CompilationUnit) node;
        _phase = phase;
        _file = file;
		_javaProject = javaProj;
		_modelCompUnit2astCompUnit = new HashMap<ICompilationUnit, CompilationUnit>();
		_typeBinding2ModelCompUnit = new HashMap<ITypeBinding, ICompilationUnit>();
        _allProblems = new HashMap<IFile, List<IProblem>>(4);        
		_filer = new FilerImpl(this);
		initPrimitives(_javaProject);
    }

