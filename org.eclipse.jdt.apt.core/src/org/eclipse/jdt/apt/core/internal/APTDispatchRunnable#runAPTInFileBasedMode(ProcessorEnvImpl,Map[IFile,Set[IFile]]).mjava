	private void runAPTInFileBasedMode(final ProcessorEnvImpl processorEnv,
									   final Map<IFile, Set<IFile>> lastGeneratedFiles)
	{
		final ICompilationParticipantResult[] cpResults = processorEnv.getFilesWithAnnotation();
		final GeneratedFileManager gfm = _aptProject.getGeneratedFileManager();
		for (ICompilationParticipantResult curResult : cpResults ) {			
			processorEnv.beginFileProcessing(curResult);
			dispatchToFileBasedProcessor(processorEnv);
			final IFile curFile = curResult.getFile();
			reportResult(
					curResult,
					lastGeneratedFiles.get(curFile),
					processorEnv.getAllGeneratedFiles(),
					processorEnv.getModifiedGeneratedFiles(),
					processorEnv.getProblems(),
					processorEnv.getTypeDependencies(),
					gfm,
					processorEnv);
			processorEnv.completedFileProcessing();
		}
	}

